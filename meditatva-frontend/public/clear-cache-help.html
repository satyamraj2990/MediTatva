<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Clear Browser Cache - MediTatva</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { color: #667eea; margin-top: 0; }
    .step {
      background: #f8f9fa;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .step h3 { margin-top: 0; color: #764ba2; }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 5px;
      font-weight: bold;
    }
    button:hover { opacity: 0.9; }
    .success {
      background: #28a745;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }
    pre {
      background: #2d3748;
      color: #48bb78;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîÑ Clear Browser Cache & Reload</h1>
    
    <div class="warning">
      <strong>‚ö†Ô∏è Your browser cached the old code!</strong><br>
      Follow the steps below to see the latest changes.
    </div>

    <div class="step">
      <h3>Option 1: Hard Refresh (Fastest)</h3>
      <p><strong>Windows/Linux:</strong> Press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></p>
      <p><strong>Mac:</strong> Press <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></p>
      <p>Or click this button:</p>
      <button onclick="location.reload(true)">üîÑ Hard Reload Now</button>
    </div>

    <div class="step">
      <h3>Option 2: Clear Cache via DevTools</h3>
      <ol>
        <li>Press <kbd>F12</kbd> to open DevTools</li>
        <li>Right-click the refresh button in the browser toolbar</li>
        <li>Select "Empty Cache and Hard Reload"</li>
      </ol>
    </div>

    <div class="step">
      <h3>Option 3: Manual Cache Clear</h3>
      <p><strong>Chrome/Edge:</strong></p>
      <ol>
        <li>Press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Delete</kbd></li>
        <li>Select "Cached images and files"</li>
        <li>Click "Clear data"</li>
      </ol>
      <button onclick="clearAndReload()">Clear & Reload</button>
    </div>

    <div class="step">
      <h3>Option 4: Open in Incognito/Private Mode</h3>
      <p><strong>Chrome:</strong> <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>N</kbd></p>
      <p><strong>Firefox:</strong> <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd></p>
      <p>Then visit: <a href="http://localhost:8080" target="_blank">http://localhost:8080</a></p>
    </div>

    <hr style="margin: 30px 0;">

    <h2>‚úÖ Verify Backend is Running</h2>
    <button onclick="testBackend()">Test Backend Connection</button>
    <div id="backend-status"></div>

    <hr style="margin: 30px 0;">

    <h2>üìã After Clearing Cache</h2>
    <div class="step">
      <h3>You Should See in Console (F12):</h3>
      <pre>üîß API Client initialized
üìç API Base URL: http://localhost:3000/api
‚úÖ SSE Connected - realtime updates active</pre>
    </div>

    <button onclick="window.location.href='/'">Go to Main App</button>
  </div>

  <script>
    async function testBackend() {
      const statusDiv = document.getElementById('backend-status');
      statusDiv.innerHTML = '<p>Testing backend...</p>';
      
      try {
        const response = await fetch('http://localhost:3000/health');
        const data = await response.json();
        
        if (data.ready) {
          statusDiv.innerHTML = `
            <div class="success">
              ‚úÖ Backend is ONLINE and READY!<br>
              Status: ${data.status}<br>
              Database: ${data.database}
            </div>
            <p><strong>The backend is working!</strong> The issue is browser cache.</p>
            <p>Please do a hard refresh: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>R</kbd></p>
          `;
        } else {
          statusDiv.innerHTML = `
            <div class="warning">
              ‚ö†Ô∏è Backend is starting up...<br>
              Please wait a moment and try again.
            </div>
          `;
        }
      } catch (error) {
        statusDiv.innerHTML = `
          <div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px;">
            ‚ùå Cannot connect to backend<br>
            Error: ${error.message}<br><br>
            <strong>Run in terminal:</strong>
            <pre style="background: #2d3748; color: white; padding: 10px; margin-top: 10px;">./start-all.sh</pre>
          </div>
        `;
      }
    }

    function clearAndReload() {
      // Clear storage
      localStorage.clear();
      sessionStorage.clear();
      
      // Clear cookies
      document.cookie.split(";").forEach(function(c) { 
        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
      });
      
      // Reload with cache bust
      window.location.href = '/?nocache=' + Date.now();
    }

    // Auto-test backend on load
    window.addEventListener('load', testBackend);
  </script>
</body>
</html>
